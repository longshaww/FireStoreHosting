<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/8.5.0/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/8.5.0/firebase-auth.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-database.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-firestore.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-functions.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-messaging.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-storage.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-analytics.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-remote-config.js"></script>
    <script defer src="/__/firebase/8.5.0/firebase-performance.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>

  </head>
  <body>
    <h1>ToDo List</h1>
    <input id = "new-item" type="text" />
    <button id = "add-btn">Add</button>
    <button id = remove-btn>Remove</button>
    <ul id ="todo-list">
    </ul>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const loadEl = document.querySelector('#load');

            var db = firebase.firestore();
            var todoList = [];
            db.collection('todos').get().then(function(snap){
              todoList = snap.docs
              render();
            });

            var addBtn = document.getElementById("add-btn")
            // addBtn.onclick = addItem;
            addBtn.addEventListener('click' , addItem);
            //trigger an event --> do addItem function
            var removeBtn = document.getElementById("remove-btn");
            removeBtn.addEventListener('click',RemoveItem);
            
        function addItem(){
            var input = document.getElementById("new-item");
            var newItem = {content: input.value};
            db.collection('todos').add(newItem).then(function(docRef){
              return docRef.get();
            }).then(function(snap){
              todoList.push(snap);
              render();
              input.value ='';
            });
        };
        function RemoveItem(){
          db.collection('todos').delete().then(function(snap){
            delete todoList[snap];
            render();
            input.value ='';
          });
        }
        
        function render(){
        var htmlList = document.getElementById("todo-list");
        var content = todoList.map(function(item){
            var data = item.data();
            return '<li>' + data.content + '</li>';
        });
        htmlList.innerHTML = content.join('');
        }
        // render([]);
      });
    </script>
  </body>
</html>
